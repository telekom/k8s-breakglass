cluster:
  clusterID: tenant-b-virtual-test
  tenant: tenant-b
  environment: development
  # Optional cluster identification fields
  # site: eu-west
  # location: eu-west-1
  
  # ==========================================
  # Authentication Configuration
  # ==========================================
  # Choose ONE of the following auth types:
  # - authType: Kubeconfig (default) - uses kubeconfigSecretRef
  # - authType: OIDC - uses either oidcAuth or oidcFromIdentityProvider
  
  # Default: Kubeconfig authentication
  # authType: Kubeconfig
  kubeconfigSecretRef:
    name: tenant-b-admin
    namespace: default
    # key: value  # Optional, defaults to "value" for Cluster API compatibility
  
  # ==========================================
  # OIDC Authentication (when authType=OIDC)
  # ==========================================
  # Option 1: Direct OIDC configuration
  # authType: OIDC
  # oidcAuth:
  #   # Required: OIDC issuer URL
  #   issuerURL: https://keycloak.example.com/realms/kubernetes
  #   # Required: OIDC client ID
  #   clientID: breakglass-controller
  #   # Required: Target cluster API server URL
  #   server: https://api.cluster.example.com:6443
  #   # Required: Client secret reference
  #   clientSecretRef:
  #     name: oidc-client-secret
  #     namespace: breakglass-system
  #     key: client-secret
  #   # Optional: CA certificate for cluster API server
  #   caSecretRef:
  #     name: cluster-ca
  #     namespace: breakglass-system
  #     key: ca.crt
  #   # Optional: Token audience (defaults to server URL)
  #   audience: https://api.cluster.example.com:6443
  #   # Optional: Additional OIDC scopes
  #   scopes:
  #     - groups
  #     - email
  #   # Optional: Skip TLS verification (not recommended for production)
  #   insecureSkipTLSVerify: false
  #   # Optional: Token exchange configuration (RFC 8693)
  #   tokenExchange:
  #     enabled: false
  #     subjectTokenSecretRef:
  #       name: subject-token-secret
  #       namespace: breakglass-system
  #       key: token
  #     resource: https://api.cluster.example.com:6443
  
  # Option 2: OIDC from IdentityProvider reference
  # authType: OIDC
  # oidcFromIdentityProvider:
  #   # Required: Name of the IdentityProvider resource
  #   name: my-keycloak-idp
  #   # Required: Target cluster API server URL
  #   server: https://api.cluster.example.com:6443
  #   # Optional: Override client ID from IdentityProvider
  #   clientID: cluster-specific-client
  #   # Optional: Client secret for this cluster
  #   clientSecretRef:
  #     name: cluster-client-secret
  #     namespace: breakglass-system
  #   # Optional: CA certificate for cluster API server
  #   caSecretRef:
  #     name: cluster-ca
  #     namespace: breakglass-system
  #   # Optional: Skip TLS verification
  #   insecureSkipTLSVerify: false
  
  # ==========================================
  # Additional Options
  # ==========================================
  # Restrict which IdentityProviders can authenticate for this cluster
  # identityProviderRefs:
  #   - my-keycloak-idp
  
  # User identifier claim: Specifies which OIDC claim the spoke cluster uses
  # for extracting the username. Must match the spoke cluster's OIDC config
  # (e.g., --oidc-username-claim or claimMappings.username.claim).
  # Valid values: "email" (default), "preferred_username", "sub"
  # userIdentifierClaim: email
  
  # Client rate limiting
  # qps: 100
  # burst: 200
  
  # Mail provider for cluster notifications (references a MailProvider CR by name)
  # If not set, uses the default MailProvider
  # mailProvider: prod-smtp-relay
  
  blockSelfApproval: false
  allowedApproverDomains: []

escalations: []
  # - name: sample-escalation
  #   allowed:
  #     clusters:
  #       - breakglass-hub
  #     groups:
  #       - dev
  #       - senior-ops
  #     # Note: 'allowed.users' is NOT a valid field - only 'allowed.groups' and 'allowed.clusters' are supported.
  #     # Users are authorized based on group membership only.
  #   escalatedGroup: breakglass-create-all
  #   approvers:
  #     groups:
  #       - senior-ops
  #       - flm-on-duty  # FLM group added as fallback
  #     # Optional: individual users who can approve
  #     users:
  #       - manager@example.com
  #       - security@example.com
  #     hiddenFromUI:
  #       - flm-on-duty  # Hide FLM from UI and notifications (fallback only)
  #   
  #   # ==========================================
  #   # Cluster and Policy Configuration
  #   # ==========================================
  #   # Alternative: Use ClusterConfig references instead of cluster names
  #   # Supports glob patterns: "*" (all clusters), "prod-*" (prefix), "*-staging" (suffix)
  #   # clusterConfigRefs:
  #   #   - prod-cluster-config
  #   #   - staging-cluster-config
  #   #   - "*"  # Use "*" for global escalations (applies to all clusters)
  #   
  #   # Optional: Attach deny policies to sessions from this escalation
  #   # denyPolicyRefs:
  #   #   - pod-security-policy
  #   #   - network-restriction-policy
  #   
  #   # ==========================================
  #   # Timing Configuration
  #   # ==========================================
  #   maxValidFor: 1h
  #   retainFor: 24h
  #   # Optional: Max time allowed for approval before session expires
  #   # approvalTimeout: 30m
  #   
  #   # ==========================================
  #   # Reason Configuration
  #   # ==========================================
  #   requestReason:
  #     mandatory: true
  #     description: "Please provide a short justification or ticket ID"
  #   # Optional: Require approver to provide a reason
  #   # approvalReason:
  #   #   mandatory: true
  #   #   description: "Provide approval justification"
  #   
  #   # ==========================================
  #   # Approval and Notification Configuration
  #   # ==========================================
  #   allowedApproverDomains:
  #     - example.org
  #   blockSelfApproval: true
  #   disableNotifications: false
  #   notificationExclusions:
  #     users:
  #       - automation@example.com
  #       - bot@example.com
  #     groups:
  #       - automated-services
  #   
  #   # Optional: Route notifications through specific mail provider
  #   # mailProvider: prod-smtp-relay
  #   
  #   # ==========================================
  #   # Multi-IDP Configuration (choose ONE approach)
  #   # ==========================================
  #   # Option 1: Legacy single list (backward compatible)
  #   # allowedIdentityProviders:
  #   #   - corporate-oidc
  #   #   - external-keycloak
  #   
  #   # Option 2: Split IDP lists (recommended for fine-grained control)
  #   # Cannot be mixed with allowedIdentityProviders
  #   # allowedIdentityProvidersForRequests:
  #   #   - corporate-oidc
  #   #   - external-keycloak
  #   # allowedIdentityProvidersForApprovers:
  #   #   - corporate-oidc
  #   
  #   # Note: If IDP fields are not set or empty, all IDPs are allowed
  #   
  #   # ==========================================
  #   # Pod Security Overrides (for DenyPolicy relaxation)
  #   # ==========================================
  #   # Allow this escalation to access high-risk pods by relaxing DenyPolicy rules
  #   # podSecurityOverrides:
  #   #   enabled: true
  #   #   # Override risk score threshold (default from DenyPolicy)
  #   #   maxAllowedScore: 150
  #   #   # Exempt specific risk factors from blocking
  #   #   exemptFactors:
  #   #     - privilegedContainer
  #   #     - hostNetwork
  #   #   # Limit overrides to specific namespaces
  #   #   namespaceScope:
  #   #     patterns:
  #   #       - "kube-system"
  #   #       - "critical-*"
  #   #   # Require additional approval before using overrides
  #   #   requireApproval: true
  #   #   approvers:
  #   #     groups:
  #   #       - security-team
  #   #     users:
  #   #       - ciso@example.com

# Multi-IDP Identity Provider Configuration Examples:
#
# For single-IDP mode (backward compatible):
# - No IdentityProvider resources needed, uses default auth configuration
#
# For multi-IDP mode:
# - Create IdentityProvider CRs with different authentication providers
# - Each escalation can restrict to specific IDPs via allowedIdentityProviders
#
# Example multi-IDP CRs (create separately, not through this chart):
#
#   apiVersion: breakglass.t-caas.telekom.com/v1alpha1
#   kind: IdentityProvider
#   metadata:
#     name: corporate-oidc
#   spec:
#     issuer: https://auth.corp.example.com
#     clientID: my-client-id
#     clientSecret:
#       secretRef:
#         name: corporate-oidc-secret
#     disabled: false
#
#   apiVersion: breakglass.t-caas.telekom.com/v1alpha1
#   kind: IdentityProvider
#   metadata:
#     name: external-keycloak
#   spec:
#     issuer: https://keycloak.external.example.com/realms/breakglass
#     clientID: keycloak-client
#     clientSecret:
#       secretRef:
#         name: keycloak-secret
#     disabled: false

# ==========================================
# Debug Session Cluster Bindings
# ==========================================
# DebugSessionClusterBindings connect DebugSessionTemplates to specific clusters,
# allowing fine-grained control over which templates are available on which clusters.
# Bindings can also override template settings for specific clusters.

debugSessionBindings: []
  # Example: Basic binding connecting a template to specific clusters
  # - name: production-debug-binding
  #   displayName: "Production Debug Access"
  #   description: "Debug access for production clusters"
  #   
  #   # Reference a single template by name (mutually exclusive with templateSelector)
  #   templateRef:
  #     name: standard-debug-template
  #   
  #   # Target specific clusters by name
  #   clusters:
  #     - prod-cluster-1
  #     - prod-cluster-2
  #   
  #   # Or target clusters by labels (combined with clusters using OR)
  #   # clusterSelector:
  #   #   matchLabels:
  #   #     environment: production
  #   
  #   # Override who can use this binding (replaces template's allowed)
  #   allowed:
  #     groups:
  #       - sre-team
  #       - platform-engineers
  #     users:
  #       - oncall@example.com
  #   
  #   # Override approvers for this binding
  #   approvers:
  #     groups:
  #       - senior-sre
  #     users:
  #       - security-lead@example.com
  #     # autoApproveFor specifies conditions for auto-approval
  #     # autoApproveFor:
  #     #   groups:
  #     #     - oncall-sre
  #     #   clusters:
  #     #     - dev-*
  #   
  #   # Add scheduling constraints (additive with template constraints)
  #   schedulingConstraints:
  #     nodeSelector:
  #       node-pool: debug-nodes
  #     tolerations:
  #       - key: "dedicated"
  #         value: "debug"
  #         effect: NoSchedule
  #     # Topology spread constraints
  #     topologySpreadConstraints:
  #       - maxSkew: 1
  #         topologyKey: topology.kubernetes.io/zone
  #         whenUnsatisfiable: ScheduleAnyway
  #     # Block specific nodes
  #     deniedNodes:
  #       - "control-plane-*"
  #     deniedNodeLabels:
  #       node-role.kubernetes.io/control-plane: "*"
  #   
  #   # Scheduling options - offer users predefined choices
  #   # schedulingOptions:
  #   #   required: true
  #   #   options:
  #   #     - name: standard
  #   #       displayName: "Standard Nodes"
  #   #       schedulingConstraints:
  #   #         nodeSelector:
  #   #           node-type: standard
  #   #     - name: high-memory
  #   #       displayName: "High Memory Nodes"
  #   #       schedulingConstraints:
  #   #         nodeSelector:
  #   #           node-type: high-memory
  #   
  #   # Session constraints (can only be MORE restrictive than template)
  #   constraints:
  #     maxDuration: "2h"
  #     defaultDuration: "30m"
  #     allowRenewal: true
  #     maxRenewals: 2
  #     maxConcurrentSessions: 2
  #   
  #   # Namespace constraints
  #   namespaceConstraints:
  #     defaultNamespace: breakglass-debug
  #     allowUserNamespace: false
  #     # createIfNotExists: false
  #     # allowedNamespaces:
  #     #   patterns:
  #     #     - "debug-*"
  #     #     - "breakglass-*"
  #   
  #   # Impersonation - deploy debug pods as specific ServiceAccount
  #   # impersonation:
  #   #   serviceAccountRef:
  #   #     name: debug-deployer
  #   #     namespace: breakglass-system
  #   
  #   # Auxiliary resources
  #   requiredAuxiliaryResourceCategories:
  #     - network-policy
  #   auxiliaryResourceOverrides:
  #     logging: true
  #     monitoring: false
  #   
  #   # Notification settings
  #   notification:
  #     enabled: true
  #     notifyOnRequest: true
  #     notifyOnApproval: true
  #     notifyOnExpiry: true
  #     notifyOnTermination: true
  #     additionalRecipients:
  #       - oncall@example.com
  #     excludedRecipients:
  #       users:
  #         - bot@example.com
  #       groups:
  #         - automation-group
  #   
  #   # Reason requirements
  #   requestReason:
  #     mandatory: true
  #     minLength: 10
  #     maxLength: 500
  #     description: "Please provide ticket ID and justification"
  #     suggestedReasons:
  #       - "Production incident"
  #       - "Security audit"
  #   approvalReason:
  #     mandatory: true
  #     mandatoryForRejection: true
  #     minLength: 10
  #     description: "Explain approval justification"
  #   
  #   # Allowed pod operations - restrict what kubectl operations users can perform
  #   # Can only be MORE restrictive than the template (cannot enable ops template disables)
  #   allowedPodOperations:
  #     exec: true       # Allow kubectl exec (also enables kubectl cp)
  #     attach: true     # Allow kubectl attach
  #     logs: false      # Allow kubectl logs (read-only)
  #     portForward: true  # Allow kubectl port-forward
  #   
  #   # Session limits
  #   maxActiveSessionsPerUser: 1
  #   maxActiveSessionsTotal: 5
  #   
  #   # Priority for UI ordering (lower = higher priority)
  #   priority: 10
  #   
  #   # Time-based activation
  #   # effectiveFrom: "2024-01-01T00:00:00Z"
  #   # expiresAt: "2024-12-31T23:59:59Z"
  #   
  #   # State flags
  #   disabled: false
  #   hidden: false
  #   
  #   # Labels and annotations for the binding resource itself
  #   labels:
  #     team: sre
  #   annotations:
  #     description: "Production debug binding"

  # Example: Binding using template selector (matches multiple templates)
  # - name: all-templates-dev-clusters
  #   templateSelector:
  #     matchLabels:
  #       tier: standard
  #   clusters:
  #     - dev-cluster
  #   displayNamePrefix: "[DEV] "
  #   constraints:
  #     maxDuration: "4h"  # More permissive for dev


# ==========================================
# Deny Policies (Cluster-Scoped)
# ==========================================
# DenyPolicies define rules that block specific actions during breakglass sessions.
# These policies are cluster-scoped and apply based on the appliesTo scope.
# Use these to restrict what escalated users can do even with elevated privileges.

denyPolicies: []
  # Example: Block dangerous operations in production
  # - name: block-dangerous-ops
  #   # Scope: which clusters/tenants this policy applies to
  #   appliesTo:
  #     clusters:
  #       - prod-cluster-1
  #       - prod-cluster-2
  #     # tenants:
  #     #   - production
  #   
  #   # Deny rules - first matching rule denies the request
  #   rules:
  #     # Block deletion of namespaces
  #     - verbs:
  #         - delete
  #       apiGroups:
  #         - ""
  #       resources:
  #         - namespaces
  #     
  #     # Block all operations on secrets in kube-system
  #     - verbs:
  #         - "*"
  #       apiGroups:
  #         - ""
  #       resources:
  #         - secrets
  #       namespaces:
  #         patterns:
  #           - kube-system
  #     
  #     # Block CRD modifications
  #     - verbs:
  #         - create
  #         - update
  #         - patch
  #         - delete
  #       apiGroups:
  #         - apiextensions.k8s.io
  #       resources:
  #         - customresourcedefinitions
  #   
  #   # Precedence (lower wins, default: 100)
  #   precedence: 50

  # Example: Pod security policy for exec/attach operations
  # - name: pod-security-policy
  #   appliesTo:
  #     clusters:
  #       - "*"  # All clusters
  #   
  #   podSecurityRules:
  #     # Which subresources trigger this evaluation (default: exec, attach, portforward)
  #     appliesTo:
  #       subresources:
  #         - exec
  #         - attach
  #         - portforward
  #     
  #     # Risk factors: assign numeric weights to dangerous pod configurations
  #     # Total score = sum of all detected factors
  #     riskFactors:
  #       hostNetwork: 50      # Pod uses host network namespace
  #       hostPID: 40          # Pod uses host PID namespace
  #       hostIPC: 30          # Pod uses host IPC namespace
  #       privilegedContainer: 100  # Container runs privileged
  #       hostPathWritable: 80      # Writable hostPath mounts
  #       hostPathReadOnly: 20      # Read-only hostPath mounts
  #       runAsRoot: 25             # Container runs as root
  #       # capabilities:          # Linux capabilities risk scores
  #       #   NET_ADMIN: 50
  #       #   SYS_ADMIN: 80
  #       #   SYS_PTRACE: 60
  #     
  #     # Thresholds: actions based on cumulative risk score
  #     thresholds:
  #       - maxScore: 50
  #         action: allow      # Low risk - permit
  #       - maxScore: 100
  #         action: warn       # Medium risk - permit but log warning
  #       - maxScore: 1000
  #         action: deny       # High risk - block
  #         reason: "Pod risk score {{.Score}} exceeds threshold. Factors: {{.Factors}}"
  #     
  #     # Block factors: immediately deny if ANY of these are present
  #     # blockFactors:
  #     #   - privilegedContainer
  #     #   - hostNetwork
  #     
  #     # Exemptions: pods/namespaces that skip security evaluation
  #     exemptions:
  #       namespaces:
  #         patterns:
  #           - kube-system
  #           - monitoring
  #       # podLabels:
  #       #   breakglass.telekom.com/security-exempt: "true"
  #     
  #     # Fail mode: behavior when pod spec cannot be fetched
  #     # "open" = allow if fetch fails, "closed" = deny if fetch fails
  #     failMode: closed
  #   
  #   precedence: 100

