# SPDX-FileCopyrightText: 2025 Deutsche Telekom AG
# SPDX-License-Identifier: Apache-2.0

# Example ClusterConfig using kubeconfig-based authentication (traditional method)
# The kubeconfig file is stored in a Kubernetes secret and used to authenticate
# to the managed cluster's API server.
apiVersion: breakglass.t-caas.telekom.com/v1alpha1
kind: ClusterConfig
metadata:
  name: my-managed-cluster
  namespace: breakglass-system
spec:
  # Authentication type - explicitly set to Kubeconfig (default if omitted)
  authType: Kubeconfig
  
  # Reference to the kubeconfig secret
  # The secret should contain a kubeconfig file with credentials to access the managed cluster
  kubeconfigSecretRef:
    name: my-cluster-kubeconfig
    namespace: breakglass-system
    key: value  # Key in secret containing kubeconfig data (default: "value" for Cluster API compatibility)
  
  # Optional: Identity provider references for user authentication
  # Uncomment and set to your actual IdentityProvider name(s)
  # identityProviderRefs:
  #   - primary-keycloak
  
  # Optional: Approved domains for session approvers
  allowedApproverDomains:
    - example.com
    - telekom.de
  
  # Optional: QPS and burst settings for API server requests
  qps: 50
  burst: 100
---
# Example Secret containing the kubeconfig
apiVersion: v1
kind: Secret
metadata:
  name: my-cluster-kubeconfig
  namespace: breakglass-system
type: Opaque
stringData:
  value: |
    apiVersion: v1
    kind: Config
    clusters:
    - cluster:
        certificate-authority-data: <base64-encoded-ca-cert>
        server: https://my-cluster.example.com:6443
      name: my-cluster
    contexts:
    - context:
        cluster: my-cluster
        user: admin
      name: my-cluster-context
    current-context: my-cluster-context
    users:
    - name: admin
      user:
        client-certificate-data: <base64-encoded-client-cert>
        client-key-data: <base64-encoded-client-key>
